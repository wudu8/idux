import{c as f,u as y,f as S,g as T,o as L,h as b,i as C,s as p,j as O}from"./index.001b24a5.js";import{P as B,f as d,Q as k,k as g,O as N,Z as m,E as j,l as I,G as _,K as w}from"./vendor.a2465f65.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const A=Symbol("anchorToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const R={affix:f.bool.def(!0),bounds:f.number,hideLinkBall:f.bool,offsetTop:f.number,target:f.oneOfType([String,HTMLElement]),targetOffset:f.number,onChange:f.emit(),onClick:f.emit()},G={href:f.string.isRequired,title:f.string};var H=B({name:"IxAnchor",props:R,setup(n,{slots:l}){const a=y("anchor"),o=d(()=>{var e;return(e=n.hideLinkBall)!=null?e:a.hideLinkBall}),u=d(()=>{const{offsetTop:e}=n;return{maxHeight:e?`calc(100vh - ${e}px)`:"100vh"}}),{activeLink:t}=M(n,a),{anchorRef:s,inkBallClasses:r,inkBallTop:h}=P(t);return()=>{var e;const i=o.value?null:k("span",{class:r.value,style:{top:h.value}},null),c=k("div",{class:"ix-anchor-wrapper",style:u.value},[k("div",{class:"ix-anchor",ref:s},[k("div",{class:"ix-anchor-ink"},[i]),(e=l.default)==null?void 0:e.call(l)])]);return n.affix?k(S,{target:n.target,offset:n.offsetTop},{default:()=>[c]}):c}}});const M=(n,l)=>{const a=g([]),o=e=>{a.value.includes(e)||a.value.push(e)},u=e=>{const i=a.value.indexOf(e);i!==-1&&a.value.splice(i,1)},t=g(),s=e=>{t.value!==e&&(t.value=e,C(n.onChange,e))},{scrollTo:r}=q(n,l,a,s);return N(A,{registerLink:o,unregisterLink:u,activeLink:t,handleLinkClick:(e,i)=>{C(n.onClick,e,i),r(i.href)}}),{activeLink:t}},P=n=>{const l=g(),a=d(()=>({"ix-anchor-ink-ball":!0,"ix-anchor-ink-ball-visible":!!n.value})),o=g();return m(()=>{j(()=>{var u;const t=(u=l.value)==null?void 0:u.querySelector(`a[data-href="${n.value}"]`);if(!t)return;const{offsetTop:s,clientHeight:r}=t;o.value=`${s+r/2-4.5}px`})}),{anchorRef:l,inkBallClasses:a,inkBallTop:o}},E=(n,l)=>{const a=document.getElementById(n.split("#")[1]);if(a){const{top:o}=O(a,l);return o}return null},$=(n,l,a,o)=>n.reduce((t,s)=>{const r=E(s,l);return r!==null&&r<a+o&&t.top<r?{link:s,top:r}:t},{link:"",top:Number.MIN_SAFE_INTEGER}).link,q=(n,l,a,o)=>{const u=d(()=>{var c;return(c=n.bounds)!=null?c:l.bounds}),t=g(),s="scroll";let r=!1;const h=d(()=>{var c,v;return(v=(c=n.targetOffset)!=null?c:n.offsetTop)!=null?v:0}),e=()=>{if(r)return;const c=$(a.value,t.value,h.value,u.value);o(c)},i=c=>{o(c);const v=E(c,t.value);v!==null&&(r=!0,p({amountOfChange:v-h.value,target:t.value,callback:()=>{r=!1}}))};return I(()=>n.target,()=>{b(t.value,s,e),t.value=T(n.target),L(t.value,s,e),e()}),m(()=>{t.value=T(n.target),L(t.value,s,e),e()}),_(()=>{b(t.value,s,e)}),{scrollTo:i}};var F=B({name:"IxAnchorLink",props:G,setup(n,{slots:l}){const{registerLink:a,unregisterLink:o,activeLink:u,handleLinkClick:t}=w(A);I(()=>n.href,(e,i)=>{o(i),a(e)}),m(()=>a(n.href)),_(()=>o(n.href));const s=d(()=>u.value===n.href),r=d(()=>({"ix-anchor-link-title":!0,"ix-anchor-link-title-active":s.value})),h=e=>t(e,n);return()=>{var e,i,c;const{href:v,title:x}=n;return k("div",{class:"ix-anchor-link"},[k("a",{class:r.value,href:v,"data-href":v,title:x,onClick:h},[(i=(e=l.title)==null?void 0:e.call(l))!=null?i:x]),(c=l.default)==null?void 0:c.call(l)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const U=H,V=F;export{U as I,V as a};
