import{u as be}from"./index.b294fd37.js";import{c as r,z as he,R as ye,aa as ge,e as X,F as Oe,u as J,A as _e,ab as xe,C as Ce,D as Se,i as R,T as Ie,a2 as we,ac as Pe,ad as $e,U as Ee,E as ke}from"./index.418e0b9f.js";import{I as Re}from"./index.beb83302.js";import{P as j,K as V,f as O,Q as y,a3 as G,Z as M,e as Te,l as ee,G as le,k,O as Ve,E as te,g as Ae,ay as ne,ad as Fe,ag as je}from"./vendor.379ae99b.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ne(){const{accessor:e,control:l}=Ce();Se(l);const n=O(()=>e.disabled.value);return{accessor:e,isDisabled:n}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function De(e,l,n,t,d){const a=k(0);M(()=>{te(()=>{const{compareWith:s,allowInput:b}=e,m=l.value;let o;if(b&&t.value){const u=t.value;o=m.findIndex(p=>p.value===u)}else{const u=n.value;o=m.findIndex(p=>u.some(c=>s(p.value,c)))}o=o===-1?0:o,a.value=ae(m,o,1)})});const i=O(()=>l.value[a.value]),v=(s,b)=>{const m=ae(l.value,s,b);m!==a.value&&(a.value=m,b!==0&&f())},f=()=>{d({index:a.value})};return{activeIndex:a,activeOption:i,changeActive:v,scrollToActivated:f}}function ae(e,l,n){const t=e.length;for(let d=0;d<t;d++){const a=(l+d*n+t)%t,{type:i,disabled:v}=e[a];if(i!=="group"&&!v)return a}return-1}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ke(e,l,n){const t=k(),d=k(""),a=k(""),i=k(!1),v=k(!1),f=()=>{if(e.multiple){const c=l.value,h=t.value;c&&h&&(h.innerText=` ${c.value}`,a.value=`${h.scrollWidth}px`)}},s=c=>{i.value=!0,R(e.onCompositionStart,c)},b=c=>{i.value&&(i.value=!1),R(e.onCompositionEnd,c)},m=c=>{if(R(e.onInput,c),!i.value&&(e.allowInput||e.searchable)){const{value:h}=c.target;h!==d.value&&(d.value=h),R(e.onSearch,h),f()}},o=c=>{v.value=!0,R(e.onFocus,c)},u=c=>{var h;v.value=!1,R(e.onBlur,c),(h=n.markAsBlurred)==null||h.call(n)},p=()=>{const c=l.value;c&&(c.value=""),d.value="",f()};return M(()=>f()),{mirrorRef:t,inputValue:d,inputWidth:a,isComposing:i,isFocused:v,handleCompositionStart:s,handleCompositionEnd:b,handleInput:m,handleFocus:o,handleBlur:u,clearInput:p}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const H="__IDUX_SELECT_OPTION",q=()=>{};q.displayName="IxSelectOption";q[H]=!0;const oe="__IDUX_SELECT_OPTION_GROUP",Q=()=>{};Q.displayName="IxSelectOptionGroup";Q[oe]=!0;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Me="__IDUX_SELECT_GENERATE_OPTION_KEY_";function se(e){const l={label:e,value:e};return{key:Me+e,label:e,value:e,rawOption:l}}var re=Object.getOwnPropertySymbols,We=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable,ie=(e,l)=>{var n={};for(var t in e)We.call(e,t)&&l.indexOf(t)<0&&(n[t]=e[t]);if(e!=null&&re)for(var t of re(e))l.indexOf(t)<0&&Be.call(e,t)&&(n[t]=e[t]);return n};function Ge(e,l,n){return O(()=>{var t;const{options:d}=e;return d?Ue(e,n,d):ue((t=l.default)==null?void 0:t.call(l))})}function Le(e,l,n){const t=He(e);return O(()=>{const d=l.value,a=n.value;if(!a)return d;const i=t.value,v=i?d.filter(s=>i(a,s.rawOption)):d,{allowInput:f}=e;return f&&!v.find(b=>b.label===a)?[se(a),...v]:v})}function Ue(e,l,n){const{childrenKey:t=l.childrenKey,labelKey:d=l.labelKey,valueKey:a=l.valueKey}=e,i=[];return n.forEach((v,f)=>{const{key:s}=v,b=v[d],m=v[t];if(m&&m.length>0){const o=s!=null?s:f;i.push({key:o,label:b,type:"group",rawOption:v}),i.push(...m.map((u,p)=>{var c;return{key:(c=u.key)!=null?c:`${ne(o)?String(o):o}-${p}`,label:u[d],value:u[a],disabled:u.disabled,type:"grouped",parentKey:o,rawOption:u}}))}else{const o=v[a];i.push({key:s!=null?s:f,disabled:v.disabled,label:b,value:o,rawOption:v})}}),i}const ze=[H,oe];function ue(e,l,n){const t=[];return Ie(e,{key:ze}).forEach((d,a)=>{var i;const{type:v,children:f,props:s}=d;if(v[H]){const m=s,{key:o,disabled:u,label:p,value:c}=m,h=ie(m,["key","disabled","label","value"]),g=u||u==="",C={key:o,disabled:g,label:p,value:c,additional:h,slots:f},x={key:o!=null?o:`${ne(l)?String(l):l}-${a}`,label:p,value:c,disabled:g,rawOption:C,parentKey:l,type:n?"grouped":void 0};t.push(x)}else{const m=s,{key:o,label:u}=m,p=ie(m,["key","label"]),c=ue((i=f==null?void 0:f.default)==null?void 0:i.call(f),o,!0),h={key:o,label:u,children:c,additional:p};t.push({key:o!=null?o:a,label:u,type:"group",rawOption:h}),t.push(...c)}}),t}const Xe=(e,l)=>{var n,t;return(t=(n=l.label)==null?void 0:n.toLowerCase().includes(e.toLowerCase()))!=null?t:!1};function He(e){return O(()=>{const{searchFilter:l}=e;return Ae(l)?l:l?Xe:!1})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function qe(e,l){const n=k(),t=k(),d=O(()=>({width:t.value})),[a,i]=we(e,"open",!1),v=()=>{var f,s;t.value=ke((f=l.value)==null?void 0:f.getBoundingClientRect().width),(s=n.value)==null||s.updatePopper()};return M(()=>{e.autofocus&&i(!0),te(()=>{a.value&&v()}),Pe(l.value,v)}),le(()=>{$e(l.value,v)}),{overlayRef:n,overlayStyle:d,overlayOpened:a,setOverlayOpened:i}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Qe(e,l,n){const t=O(()=>Ee(l.valueRef.value)),d=O(()=>{const{compareWith:s}=e,b=n.value;return t.value.map(m=>{var o;return(o=b.find(u=>s(u.value,m)))!=null?o:se(m)})}),a=s=>{const b=e.multiple?s:s[0],m=je(l.valueRef.value);b!==m&&(l.setValue(b),R(e.onChange,b,m))};return{selectedValue:t,selectedOptions:d,changeSelected:s=>{const{compareWith:b,multiple:m,multipleLimit:o}=e,u=t.value,p=u.findIndex(h=>b(h,s)),c=p>-1;m?c?a(u.filter((h,g)=>p!==g)):u.length<o?a([...u,s]):a([...u.slice(-o+1),s]):!c&&a([s])},handleItemRemove:s=>{a(t.value.filter(b=>!e.compareWith(s,b)))},handleClear:s=>{s.stopPropagation(),a([]),R(e.onClear,s)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const A=Symbol("selectToken"),Ye={height:0,width:0,overflow:"hidden"},Ze=()=>{const{props:e,selectedValue:l,mergedOptions:n,activeIndex:t,activeOption:d}=V(A),a=l.value,{compareWith:i}=e;return y("div",{role:"listbox",style:Ye},[Y(n.value[t.value-1],a,i),Y(d.value,a,i),Y(n.value[t.value+1],a,i)])},Y=(e,l,n)=>{var t,d,a;if(!e)return;const{key:i,label:v,rawOption:f,value:s}=e,b=n(l,s);return y("div",{key:i,role:"option","aria-label":v,"aria-selected":b},[(a=(d=(t=f.slots)==null?void 0:t.default)==null?void 0:d.call(t,f))!=null?a:v])};/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Je=(e,l)=>e===l,el={value:r.any,control:he,open:r.bool,allowInput:r.bool.def(!1),autofocus:r.bool.def(!1),borderless:r.bool,childrenKey:r.string,clearable:r.bool.def(!1),compareWith:r.func().def(Je),disabled:r.bool.def(!1),empty:r.oneOfType([String,r.object()]),maxLabelCount:r.number.def(Number.MAX_SAFE_INTEGER),multiple:r.bool.def(!1),multipleLimit:r.number.def(Number.MAX_SAFE_INTEGER),labelKey:r.string,options:r.array(),overlayClassName:r.string,overlayRender:r.func(),placeholder:r.string,readonly:r.bool.def(!1),searchable:r.bool.def(!1),searchFilter:r.oneOfType([Boolean,r.func()]).def(!0),size:r.oneOf(["sm","md","lg"]),suffix:r.string,valueKey:r.string,virtual:r.bool.def(!1),"onUpdate:value":r.emit(),"onUpdate:open":r.emit(),onChange:r.emit(),onClear:r.emit(),onCompositionStart:r.emit(),onCompositionEnd:r.emit(),onBlur:r.emit(),onFocus:r.emit(),onInput:r.emit(),onSearch:r.emit(),onScroll:r.emit(),onScrolledChange:r.emit(),onScrolledBottom:r.emit(),overlayHeight:r.number.def(256),overlayItemHeight:r.number.def(32)};r.bool.def(!1),r.string,r.any.isRequired;r.string;const ll={clearable:r.bool,suffix:r.string},tl={disabled:r.bool,index:r.number.isRequired,label:r.string,type:r.oneOf(["grouped","group"]),rawOption:r.object().isRequired,value:r.any},nl={label:r.string,rawOption:r.object().isRequired};var al=j({props:tl,setup(e){const{props:l,mergedPrefixCls:n,selectedValue:t,handleOptionClick:d,activeOption:a,changeActive:i}=V(A),v=O(()=>{var o;const{value:u}=e,{compareWith:p}=l,c=(o=a.value)==null?void 0:o.value;return p(c,u)}),f=O(()=>{const{value:o}=e,{compareWith:u}=l;return t.value.some(p=>u(p,o))}),s=O(()=>{const{disabled:o,type:u}=e,p=`${n.value}-option`;return{[p]:!0,[`${p}-active`]:v.value,[`${p}-disabled`]:o,[`${p}-grouped`]:u==="grouped",[`${p}-selected`]:f.value}}),b=()=>i(e.index,0),m=()=>d(e.value);return()=>{var o,u,p;const{disabled:c,label:h,rawOption:g}=e,{multiple:C}=l,x=f.value,P=`${n.value}-option`;return y("div",G({class:s.value,onMouseenter:c?void 0:b,onClick:c?void 0:m},g.additional,{"aria-label":h,"aria-selected":x}),[C&&y(Re,{checked:f.value,disabled:c},null),y("span",{class:`${P}-label`},[(p=(u=(o=g.slots)==null?void 0:o.default)==null?void 0:u.call(o,g))!=null?p:h])])}}}),ol=j({props:nl,setup(e){const{mergedPrefixCls:l}=V(A);return()=>{var n,t,d;const{label:a,rawOption:i}=e,v=`${l.value}-option-group`;return y("div",G({class:v},i.additional,{"aria-label":a}),[y("span",{class:`${v}-label`},[(d=(t=(n=i.slots)==null?void 0:n.default)==null?void 0:t.call(n,i))!=null?d:a])])}}}),ce=Object.getOwnPropertySymbols,sl=Object.prototype.hasOwnProperty,rl=Object.prototype.propertyIsEnumerable,il=(e,l)=>{var n={};for(var t in e)sl.call(e,t)&&l.indexOf(t)<0&&(n[t]=e[t]);if(e!=null&&ce)for(var t of ce(e))l.indexOf(t)<0&&rl.call(e,t)&&(n[t]=e[t]);return n},ul=j({setup(){const{props:e,slots:l,flattedOptions:n,virtualScrollRef:t,scrollToActivated:d}=V(A);M(()=>d());const a=(i,v,f)=>{const{onScrolledChange:s}=e;s&&R(s,i,v,f.map(b=>b.rawOption))};return()=>{const{overlayHeight:i,overlayItemHeight:v,virtual:f,onScroll:s,onScrolledBottom:b,overlayRender:m}=e,o=n.value,u=[y(Ze,null,null)];if(o.length>0){const p=({item:c,index:h})=>{const g=c,{type:C}=g,x=il(g,["type"]);return C==="group"?y(ol,x,null):y(al,G({index:h},x),null)};u.push(y(ye,{ref:t,dataSource:o,height:i,itemHeight:v,itemKey:"key",itemRender:p,virtual:f,onScroll:s,onScrolledBottom:b,onScrolledChange:a},null))}else u.push(y(ge,{empty:e.empty},l));return m?m(u):y("div",null,[u])}}}),cl=j({setup(){const{props:e,mergedPrefixCls:l,isDisabled:n,inputRef:t,inputValue:d,inputWidth:a,mirrorRef:i,handleCompositionStart:v,handleCompositionEnd:f,handleInput:s}=V(A),b=O(()=>({width:a.value})),m=O(()=>{const{allowInput:o,searchable:u}=e;return{opacity:o||u?void 0:0}});return()=>{const{autofocus:o,multiple:u}=e,p=`${l.value}-selector-input`;return y("div",{class:p,style:b.value},[y("input",{ref:t,class:`${p}-inner`,style:m.value,autocomplete:"off",autofocus:o,disabled:n.value,value:d.value,onCompositionstart:v,onCompositionend:f,onInput:s},null),u&&y("span",{ref:i,class:`${p}-mirror`,"aria-hidden":!0},null)])}}});const dl=(e,{slots:l})=>{const{disabled:n,prefixCls:t,removable:d,value:a,handleItemRemove:i}=e,v=t+(n?` ${t}-disabled`:""),f=s=>{s.stopPropagation(),i(a)};return y("div",{class:v},[y("span",{class:`${t}-label`},[l.default()]),!n&&d&&y("span",{class:`${t}-remove`,onClick:f},[y(X,{name:"close"},null)])])};var vl=j({props:ll,setup(e){const{props:l,slots:n,mergedPrefixCls:t,isDisabled:d,selectedValue:a,selectedOptions:i,handleItemRemove:v,handleClear:f,inputValue:s,isComposing:b}=V(A),m=O(()=>{const{maxLabelCount:p}=l,c=i.value,h=c.slice(0,p);if(c.length>p){const g="IDUX_SELECT_MAX_ITEM",C=`+ ${c.length-p} ...`,x=c.slice(p).map(P=>P.rawOption);h.push({isMax:!0,key:g,label:C,value:x})}return h}),o=O(()=>l.multiple||a.value.length>0&&!b.value&&!s.value),u=O(()=>a.value.length===0&&!b.value&&!s.value);return()=>{var p,c,h,g;const{clearable:C,suffix:x}=e,{multiple:P}=l,N=d.value,$=`${t.value}-selector`,D=`${$}-item`,_=m.value.map(w=>{var E,F,K,S,W,B,I;const{key:T,isMax:L,label:U,value:pe,rawOption:fe}=w,me={key:T,disabled:N||w.disabled,prefixCls:D,removable:P&&!L,value:pe,handleItemRemove:v,title:U};let z;return L?z=(F=(E=n.maxLabel)==null?void 0:E.call(n,w.value))!=null?F:U:z=(I=(B=(K=n.label)==null?void 0:K.call(n,w.rawOption))!=null?B:(W=(S=fe.slots)==null?void 0:S.default)==null?void 0:W.call(S))!=null?I:U,y(dl,me,{default:()=>[z]})});return y("div",{class:$},[o.value&&_,y(cl,null,null),u.value&&y("div",{class:`${$}-placeholder`},[Te(" "),(c=(p=n.placeholder)==null?void 0:p.call(n))!=null?c:l.placeholder]),(n.suffix||x)&&y("div",{class:`${$}-suffix`},[(g=(h=n.suffix)==null?void 0:h.call(n))!=null?g:y(X,{name:x},null)]),C&&y("div",{class:`${$}-clear`,onClick:f},[y(X,{name:"close-circle"},null)])])}}});const pl={width:0,height:0,display:"flex",overflow:"hidden",opacity:0};var fl=j({setup(){const{props:e,slots:l,config:n,mergedPrefixCls:t,focusMonitor:d,triggerRef:a,isDisabled:i,selectedValue:v,isFocused:f,handleFocus:s,handleBlur:b,overlayOpened:m,setOverlayOpened:o,activeIndex:u,activeOption:p,changeActive:c,changeSelected:h}=V(A),g=V(Oe,null),C=O(()=>!i.value&&e.clearable&&v.value.length>0),x=O(()=>!i.value&&e.searchable),P=O(()=>{const{suffix:_}=e;return _||(e.searchable&&f.value?"search":n.suffix)}),N=O(()=>{var _;const{borderless:w=n.borderless,multiple:E,size:F=(_=g==null?void 0:g.size.value)!=null?_:n.size}=e,K=i.value,S=t.value;return{[S]:!0,[`${S}-borderless`]:w,[`${S}-clearable`]:C.value,[`${S}-disabled`]:K,[`${S}-focused`]:f.value,[`${S}-opened`]:m.value,[`${S}-multiple`]:E,[`${S}-single`]:!E,[`${S}-searchable`]:x.value,[`${S}-with-suffix`]:l.suffix||P.value,[`${S}-${F}`]:!0}}),$=()=>{const _=m.value;_&&x.value||i.value||o(!_)},D=_=>{var w;switch(_.code){case"ArrowUp":_.preventDefault(),c(u.value-1,-1);break;case"ArrowDown":_.preventDefault(),c(u.value+1,1);break;case"Enter":_.preventDefault(),h((w=p.value)==null?void 0:w.value);break;case"Escape":_.preventDefault(),o(!1);break}};return M(()=>{ee(d.monitor(a.value,!0),_=>{const{origin:w,event:E}=_;E&&(w?s(E):b(E))})}),le(()=>d.stopMonitoring(a.value)),()=>y("div",{ref:a,class:N.value,onClick:$,onKeydown:D},[f.value&&!m.value&&y("span",{style:pl,"aria-live":"polite"},[v.value.join(", ")]),y(vl,{clearable:C.value,suffix:P.value},null)])}}),ml=Object.defineProperty,de=Object.getOwnPropertySymbols,bl=Object.prototype.hasOwnProperty,hl=Object.prototype.propertyIsEnumerable,ve=(e,l,n)=>l in e?ml(e,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[l]=n,Z=(e,l)=>{for(var n in l||(l={}))bl.call(l,n)&&ve(e,n,l[n]);if(de)for(var n of de(l))hl.call(l,n)&&ve(e,n,l[n]);return e};const yl=[0,8];var gl=j({name:"IxSelect",inheritAttrs:!1,props:el,setup(e,{attrs:l,expose:n,slots:t}){const d=J("common"),a=O(()=>`${d.prefixCls}-select`),i=J("select"),v=be(),{elementRef:f,focus:s,blur:b}=_e(),m=k(),o=I=>{var T;(T=m.value)==null||T.scrollTo(I)};n({focus:s,blur:b,scrollTo:o});const u=k(),{overlayRef:p,overlayStyle:c,overlayOpened:h,setOverlayOpened:g}=qe(e,u),{accessor:C,isDisabled:x}=Ne(),P=Ge(e,t,i),N=Ke(e,f,C),{inputValue:$,clearInput:D}=N,_=Le(e,P,$),w=Qe(e,C,P),{selectedValue:E,changeSelected:F}=w,K=De(e,_,E,$,o);Ve(A,Z(Z(Z({props:e,slots:t,config:i,mergedPrefixCls:a,focusMonitor:v,triggerRef:u,inputRef:f,virtualScrollRef:m,overlayOpened:h,setOverlayOpened:g,accessor:C,isDisabled:x,mergedOptions:P,flattedOptions:_,handleOptionClick:I=>{F(I),e.multiple?(s(),D()):g(!1)}},w),N),K)),ee(h,I=>{!I&&e.allowInput&&$.value&&F($.value),I?s():b(),D()});const W=O(()=>{const{overlayClassName:I}=e,T=a.value;return Fe({[`${T}-dropdown`]:!0,[I||""]:!!I})}),B=O(()=>`${a.value}-overlay`);return()=>{const I=()=>y(fl,l,null),T=()=>y(ul,null,null);return y(xe,G({ref:p},{"onUpdate:visible":g},{visible:h.value,class:W.value,style:c.value,clickOutside:!0,disabled:x.value||e.readonly,offset:yl,placement:"bottom",target:B.value,trigger:"manual"}),{default:I,content:T})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Sl=gl,Il=q,wl=Q;export{Il as I,Sl as a,wl as b};
