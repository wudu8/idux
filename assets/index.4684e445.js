import{u as be}from"./index.6fa6e5cb.js";import{c as i,z as he,R as ye,a7 as ge,e as U,F as Oe,u as ee,A as _e,a8 as xe,C as Ce,D as Se,i as T,a9 as Ie,$ as we,aa as $e,ab as Pe,ac as Ee,E as ke}from"./index.789a60d9.js";import{I as Re}from"./index.7adccb01.js";import{P as F,K as V,f as x,Q as h,a3 as W,Z as B,l as z,e as Te,G as le,k,O as Ve,E as te,g as Ae,ac as ne,ai as Fe,ag as Ne}from"./vendor.a2465f65.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function je(){const{accessor:e,control:l}=Ce();Se(l);const t=x(()=>e.disabled.value);return{accessor:e,isDisabled:t}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function De(e,l,t,n,d){const o=k(0);te(()=>{const{compareWith:f,allowInput:g}=e,b=l.value;let a;if(g&&n.value){const c=n.value;a=b.findIndex(p=>p.value===c)}else{const c=t.value;a=b.findIndex(p=>c.some(r=>f(p.value,r)))}a=a===-1?0:a,o.value=ae(b,a,1)});const s=x(()=>l.value[o.value]),v=(f,g)=>{const b=ae(l.value,f,g);b!==o.value&&(o.value=b,g!==0&&u())},u=()=>{d({index:o.value})};return{activeIndex:o,activeOption:s,changeActive:v,scrollToActivated:u}}function ae(e,l,t){const n=e.length;for(let d=0;d<n;d++){const o=(l+d*t+n)%n,{type:s,disabled:v}=e[o];if(s!=="group"&&!v)return o}return-1}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ke(e,l,t){const n=k(),d=k(""),o=k(""),s=k(!1),v=k(!1),u=()=>{if(e.multiple){const r=l.value,m=n.value;r&&m&&(m.innerText=` ${r.value}`,o.value=`${m.scrollWidth}px`)}};return{mirrorRef:n,inputValue:d,inputWidth:o,isComposing:s,isFocused:v,syncMirrorWidth:u,handleCompositionStart:r=>{s.value=!0,T(e.onCompositionStart,r)},handleCompositionEnd:r=>{s.value&&(s.value=!1),T(e.onCompositionEnd,r)},handleInput:r=>{if(T(e.onInput,r),!s.value&&(e.allowInput||e.searchable)){const{value:m}=r.target;m!==d.value&&(d.value=m),T(e.onSearch,m),u()}},handleFocus:r=>{v.value=!0,T(e.onFocus,r)},handleBlur:r=>{var m;v.value=!1,T(e.onBlur,r),(m=t.markAsBlurred)==null||m.call(t)},clearInput:()=>{const r=l.value;r&&(r.value=""),d.value="",u()}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const X="__IDUX_SELECT_OPTION",H=()=>{};H.displayName="IxSelectOption";H[X]=!0;const oe="__IDUX_SELECT_OPTION_GROUP",q=()=>{};q.displayName="IxSelectOptionGroup";q[oe]=!0;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Me="__IDUX_SELECT_GENERATE_INPUT_OPTION_KEY_";function se(e){const l={label:e,value:e};return{key:Me+e,label:e,value:e,rawOption:l}}var re=Object.getOwnPropertySymbols,We=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable,ie=(e,l)=>{var t={};for(var n in e)We.call(e,n)&&l.indexOf(n)<0&&(t[n]=e[n]);if(e!=null&&re)for(var n of re(e))l.indexOf(n)<0&&Be.call(e,n)&&(t[n]=e[n]);return t};function Ge(e,l,t){return x(()=>{var n;const{options:d}=e;return d?Ue(e,t,d):ue((n=l.default)==null?void 0:n.call(l))})}function Le(e,l,t){const n=He(e);return x(()=>{const d=l.value,o=t.value;if(!o)return d;const s=n.value,v=s?d.filter(f=>s(o,f.rawOption)):d,{allowInput:u}=e;return u&&!v.find(g=>g.label===o)?[se(o),...v]:v})}function Ue(e,l,t){const{childrenKey:n=l.childrenKey,labelKey:d=l.labelKey,valueKey:o=l.valueKey}=e,s=[];return t.forEach((v,u)=>{const{key:f}=v,g=v[d],b=v[n];if(b&&b.length>0){const a=f!=null?f:u;s.push({key:a,label:g,type:"group",rawOption:v}),s.push(...b.map((c,p)=>{var r;return{key:(r=c.key)!=null?r:`${ne(a)?String(a):a}-${p}`,label:c[d],value:c[o],disabled:c.disabled,type:"grouped",parentKey:a,rawOption:c}}))}else{const a=v[o];s.push({key:f!=null?f:u,disabled:v.disabled,label:g,value:a,rawOption:v})}}),s}const ze=[X,oe];function ue(e,l,t){const n=[];return Ie(e,{key:ze}).forEach((d,o)=>{var s;const{type:v,children:u,props:f}=d;if(v[X]){const b=f,{key:a,disabled:c,label:p,value:r}=b,m=ie(b,["key","disabled","label","value"]),y=c||c==="",_={key:a,disabled:y,label:p,value:r,additional:m,slots:u},O={key:a!=null?a:`${ne(l)?String(l):l}-${o}`,label:p,value:r,disabled:y,rawOption:_,parentKey:l,type:t?"grouped":void 0};n.push(O)}else{const b=f,{key:a,label:c}=b,p=ie(b,["key","label"]),r=ue((s=u==null?void 0:u.default)==null?void 0:s.call(u),a,!0),m={key:a,label:c,children:r,additional:p};n.push({key:a!=null?a:o,label:c,type:"group",rawOption:m}),n.push(...r)}}),n}const Xe=(e,l)=>{var t,n;return(n=(t=l.label)==null?void 0:t.toLowerCase().includes(e.toLowerCase()))!=null?n:!1};function He(e){return x(()=>{const{searchFilter:l}=e;return Ae(l)?l:l?Xe:!1})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function qe(e,l){const t=k(),n=k(),d=x(()=>({width:n.value})),[o,s]=we(e,"open",!1),v=()=>{var f;n.value=ke((f=l.value)==null?void 0:f.getBoundingClientRect().width)},u=()=>{var f;v(),(f=t.value)==null||f.updatePopper()};return B(()=>{te(()=>{o.value&&v()}),$e(l.value,u)}),le(()=>{Pe(l.value,u)}),{overlayRef:t,overlayStyle:d,overlayOpened:o,setOverlayOpened:s}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Qe(e,l,t,n,d,o){const s=x(()=>Ee(l.valueRef.value)),v=x(()=>{const{compareWith:a}=e,c=t.value;return s.value.map(p=>{var r;return(r=c.find(m=>a(m.value,p)))!=null?r:se(p)})}),u=a=>{const c=e.multiple?a:a[0],p=Ne(l.valueRef.value);c!==p&&(l.setValue(c),T(e.onChange,c,p))};return{selectedValue:s,selectedOptions:v,changeSelected:a=>{const{compareWith:c,multiple:p,multipleLimit:r}=e,m=s.value,y=m.findIndex(O=>c(O,a)),_=y>-1;p?(_?u(m.filter((O,I)=>y!==I)):m.length<r?u([...m,a]):u([...m.slice(-r+1),a]),n(),o()):(!_&&u([a]),d(!1))},handleItemRemove:a=>{u(s.value.filter(c=>!e.compareWith(a,c)))},handleClear:a=>{a.stopPropagation(),u([]),T(e.onClear,a)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const A=Symbol("selectToken"),Ye={height:0,width:0,overflow:"hidden"},Ze=()=>{const{props:e,selectedValue:l,mergedOptions:t,activeIndex:n,activeOption:d}=V(A),o=l.value,{compareWith:s}=e;return h("div",{role:"listbox",style:Ye},[Q(t.value[n.value-1],o,s),Q(d.value,o,s),Q(t.value[n.value+1],o,s)])},Q=(e,l,t)=>{var n,d,o;if(!e)return;const{key:s,label:v,rawOption:u,value:f}=e,g=t(l,f);return h("div",{key:s,role:"option","aria-label":v,"aria-selected":g},[(o=(d=(n=u.slots)==null?void 0:n.default)==null?void 0:d.call(n,u))!=null?o:v])};/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Je=(e,l)=>e===l,el={value:i.any,control:he,open:i.bool,allowInput:i.bool.def(!1),autofocus:i.bool.def(!1),borderless:i.bool,childrenKey:i.string,clearable:i.bool.def(!1),compareWith:i.func().def(Je),disabled:i.bool.def(!1),empty:i.oneOfType([String,i.object()]),maxLabelCount:i.number.def(Number.MAX_SAFE_INTEGER),multiple:i.bool.def(!1),multipleLimit:i.number.def(Number.MAX_SAFE_INTEGER),labelKey:i.string,options:i.array(),overlayClassName:i.string,overlayRender:i.func(),placeholder:i.string,readonly:i.bool.def(!1),searchable:i.bool.def(!1),searchFilter:i.oneOfType([Boolean,i.func()]).def(!0),size:i.oneOf(["sm","md","lg"]),suffix:i.string,valueKey:i.string,virtual:i.bool.def(!1),"onUpdate:value":i.emit(),"onUpdate:open":i.emit(),onChange:i.emit(),onClear:i.emit(),onCompositionStart:i.emit(),onCompositionEnd:i.emit(),onBlur:i.emit(),onFocus:i.emit(),onInput:i.emit(),onSearch:i.emit(),onScroll:i.emit(),onScrolledChange:i.emit(),onScrolledBottom:i.emit(),overlayHeight:i.number.def(256),overlayItemHeight:i.number.def(32)};i.bool.def(!1),i.string,i.any.isRequired;i.string;const ll={clearable:i.bool,suffix:i.string},tl={disabled:i.bool,index:i.number.isRequired,label:i.string,type:i.oneOf(["grouped","group"]),rawOption:i.object().isRequired,value:i.any},nl={label:i.string,rawOption:i.object().isRequired};var al=F({props:tl,setup(e){const{props:l,mergedPrefixCls:t,selectedValue:n,changeSelected:d,activeOption:o,changeActive:s}=V(A),v=x(()=>{var a;const{value:c}=e,{compareWith:p}=l,r=(a=o.value)==null?void 0:a.value;return p(r,c)}),u=x(()=>{const{value:a}=e,{compareWith:c}=l;return n.value.some(p=>c(p,a))}),f=x(()=>{const{disabled:a,type:c}=e,p=`${t.value}-option`;return{[p]:!0,[`${p}-active`]:v.value,[`${p}-disabled`]:a,[`${p}-grouped`]:c==="grouped",[`${p}-selected`]:u.value}}),g=()=>s(e.index,0),b=()=>d(e.value);return()=>{var a,c,p;const{disabled:r,label:m,rawOption:y}=e,{multiple:_}=l,O=u.value,I=`${t.value}-option`;return h("div",W({class:f.value,onMouseenter:r?void 0:g,onClick:r?void 0:b},y.additional,{"aria-label":m,"aria-selected":O}),[_&&h(Re,{checked:u.value,disabled:r},null),h("span",{class:`${I}-label`},[(p=(c=(a=y.slots)==null?void 0:a.default)==null?void 0:c.call(a,y))!=null?p:m])])}}}),ol=F({props:nl,setup(e){const{mergedPrefixCls:l}=V(A);return()=>{var t,n,d;const{label:o,rawOption:s}=e,v=`${l.value}-option-group`;return h("div",W({class:v},s.additional,{"aria-label":o}),[h("span",{class:`${v}-label`},[(d=(n=(t=s.slots)==null?void 0:t.default)==null?void 0:n.call(t,s))!=null?d:o])])}}}),ce=Object.getOwnPropertySymbols,sl=Object.prototype.hasOwnProperty,rl=Object.prototype.propertyIsEnumerable,il=(e,l)=>{var t={};for(var n in e)sl.call(e,n)&&l.indexOf(n)<0&&(t[n]=e[n]);if(e!=null&&ce)for(var n of ce(e))l.indexOf(n)<0&&rl.call(e,n)&&(t[n]=e[n]);return t},ul=F({setup(){const{props:e,slots:l,flattedOptions:t,virtualScrollRef:n,scrollToActivated:d}=V(A);B(()=>d());const o=(s,v,u)=>{T(e.onScrolledChange,s,v,u.map(f=>f.rawOption))};return()=>{const{overlayHeight:s,overlayItemHeight:v,virtual:u,onScroll:f,onScrolledBottom:g,overlayRender:b}=e,a=t.value,c=[h(Ze,null,null)];if(a.length>0){const p=({item:r,index:m})=>{const y=r,{type:_}=y,O=il(y,["type"]);return _==="group"?h(ol,O,null):h(al,W({index:m},O),null)};c.push(h(ye,{ref:n,dataSource:a,height:s,itemHeight:v,itemKey:"key",itemRender:p,virtual:u,onScroll:f,onScrolledBottom:g,onScrolledChange:o},null))}else c.push(h(ge,{empty:e.empty},l));return b?b(c):h("div",null,[c])}}}),cl=F({setup(){const{props:e,mergedPrefixCls:l,isDisabled:t,inputRef:n,focus:d,blur:o,inputValue:s,inputWidth:v,overlayOpened:u,setOverlayOpened:f,mirrorRef:g,syncMirrorWidth:b,handleCompositionStart:a,handleCompositionEnd:c,handleInput:p}=V(A);B(()=>{b(),z(u,y=>y?d():o()),e.autofocus&&f(!0)});const r=x(()=>({width:v.value})),m=x(()=>{const{allowInput:y,searchable:_}=e;return{opacity:y||_?void 0:0}});return()=>{const{autofocus:y,multiple:_}=e,O=`${l.value}-selector-input`;return h("div",{class:O,style:r.value},[h("input",{ref:n,class:`${O}-inner`,style:m.value,autocomplete:"off",autofocus:y,disabled:t.value,value:s.value,onCompositionstart:a,onCompositionend:c,onInput:p},null),_&&h("span",{ref:g,class:`${O}-mirror`,"aria-hidden":!0},null)])}}});const dl=(e,{slots:l})=>{const{disabled:t,prefixCls:n,removable:d,value:o,handleItemRemove:s}=e,v=n+(t?` ${n}-disabled`:""),u=f=>{f.stopPropagation(),s(o)};return h("div",{class:v},[h("span",{class:`${n}-label`},[l.default()]),!t&&d&&h("span",{class:`${n}-remove`,onClick:u},[h(U,{name:"close"},null)])])};var vl=F({props:ll,setup(e){const{props:l,slots:t,mergedPrefixCls:n,isDisabled:d,selectedValue:o,selectedOptions:s,handleItemRemove:v,handleClear:u,inputValue:f,isComposing:g}=V(A),b=x(()=>{const{maxLabelCount:p}=l,r=s.value,m=r.slice(0,p);if(r.length>p){const y="IDUX_SELECT_MAX_ITEM",_=`+ ${r.length-p} ...`,O=r.slice(p).map(I=>I.rawOption);m.push({isMax:!0,key:y,label:_,value:O})}return m}),a=x(()=>l.multiple||o.value.length>0&&!g.value&&!f.value),c=x(()=>o.value.length===0&&!g.value&&!f.value);return()=>{var p,r,m,y;const{clearable:_,suffix:O}=e,{multiple:I}=l,N=d.value,$=`${n.value}-selector`,j=`${$}-item`,C=b.value.map(w=>{var E,D,K,S,M,P,R;const{key:Z,isMax:J,label:G,value:pe,rawOption:fe}=w,me={key:Z,disabled:N||w.disabled,prefixCls:j,removable:I&&!J,value:pe,handleItemRemove:v,title:G};let L;return J?L=(D=(E=t.maxLabel)==null?void 0:E.call(t,w.value))!=null?D:G:L=(R=(P=(K=t.label)==null?void 0:K.call(t,w.rawOption))!=null?P:(M=(S=fe.slots)==null?void 0:S.default)==null?void 0:M.call(S))!=null?R:G,h(dl,me,{default:()=>[L]})});return h("div",{class:$},[a.value&&C,h(cl,null,null),c.value&&h("div",{class:`${$}-placeholder`},[Te(" "),(r=(p=t.placeholder)==null?void 0:p.call(t))!=null?r:l.placeholder]),(t.suffix||O)&&h("div",{class:`${$}-suffix`},[(y=(m=t.suffix)==null?void 0:m.call(t))!=null?y:h(U,{name:O},null)]),_&&h("div",{class:`${$}-clear`,onClick:u},[h(U,{name:"close-circle"},null)])])}}});const pl={width:0,height:0,display:"flex",overflow:"hidden",opacity:0};var fl=F({setup(){const{props:e,slots:l,config:t,mergedPrefixCls:n,focusMonitor:d,triggerRef:o,isDisabled:s,selectedValue:v,isFocused:u,handleFocus:f,handleBlur:g,overlayOpened:b,setOverlayOpened:a,activeIndex:c,activeOption:p,changeActive:r,changeSelected:m}=V(A),y=V(Oe,null),_=x(()=>!s.value&&e.clearable&&v.value.length>0),O=x(()=>!s.value&&e.searchable),I=x(()=>{const{suffix:C}=e;return C||(e.searchable&&u.value?"search":t.suffix)}),N=x(()=>{var C;const{borderless:w=t.borderless,multiple:E,size:D=(C=y==null?void 0:y.size.value)!=null?C:t.size}=e,K=s.value,S=n.value;return{[S]:!0,[`${S}-borderless`]:w,[`${S}-clearable`]:_.value,[`${S}-disabled`]:K,[`${S}-focused`]:u.value,[`${S}-opened`]:b.value,[`${S}-multiple`]:E,[`${S}-single`]:!E,[`${S}-searchable`]:O.value,[`${S}-with-suffix`]:l.suffix||I.value,[`${S}-${D}`]:!0}}),$=()=>{const C=b.value;C&&O.value||s.value||a(!C)},j=C=>{var w;switch(C.code){case"ArrowUp":C.preventDefault(),r(c.value-1,-1);break;case"ArrowDown":C.preventDefault(),r(c.value+1,1);break;case"Enter":C.preventDefault(),m((w=p.value)==null?void 0:w.value);break;case"Escape":C.preventDefault(),a(!1);break}};return B(()=>{z(d.monitor(o.value,!0),C=>{const{origin:w,event:E}=C;E&&(w?f(E):g(E))})}),le(()=>d.stopMonitoring(o.value)),()=>h("div",{ref:o,class:N.value,onClick:$,onKeydown:j},[u.value&&!b.value&&h("span",{style:pl,"aria-live":"polite"},[v.value.join(", ")]),h(vl,{clearable:_.value,suffix:I.value},null)])}}),ml=Object.defineProperty,de=Object.getOwnPropertySymbols,bl=Object.prototype.hasOwnProperty,hl=Object.prototype.propertyIsEnumerable,ve=(e,l,t)=>l in e?ml(e,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[l]=t,Y=(e,l)=>{for(var t in l||(l={}))bl.call(l,t)&&ve(e,t,l[t]);if(de)for(var t of de(l))hl.call(l,t)&&ve(e,t,l[t]);return e};const yl=[0,8];var gl=F({name:"IxSelect",inheritAttrs:!1,props:el,setup(e,{attrs:l,expose:t,slots:n}){const d=ee("common"),o=x(()=>`${d.prefixCls}-select`),s=ee("select"),v=be(),{elementRef:u,focus:f,blur:g}=_e(),b=k(),a=P=>{var R;(R=b.value)==null||R.scrollTo(P)};t({focus:f,blur:g,scrollTo:a});const c=k(),{overlayRef:p,overlayStyle:r,overlayOpened:m,setOverlayOpened:y}=qe(e,c),{accessor:_,isDisabled:O}=je(),I=Ge(e,n,s),N=Ke(e,u,_),{inputValue:$,clearInput:j}=N,C=Le(e,I,$),w=Qe(e,_,I,f,y,j),{selectedValue:E,changeSelected:D}=w,K=De(e,C,E,$,a);Ve(A,Y(Y(Y({props:e,slots:n,config:s,mergedPrefixCls:o,focusMonitor:v,inputRef:u,focus:f,blur:g,virtualScrollRef:b,triggerRef:c,overlayOpened:m,setOverlayOpened:y,accessor:_,isDisabled:O,mergedOptions:I,flattedOptions:C},w),N),K)),z(m,P=>{!P&&e.allowInput&&$.value&&D($.value),j()});const S=x(()=>{const{overlayClassName:P}=e,R=o.value;return Fe({[`${R}-dropdown`]:!0,[P||""]:!!P})}),M=x(()=>`${o.value}-overlay`);return()=>{const P=()=>h(fl,l,null),R=()=>h(ul,null,null);return h(xe,W({ref:p},{"onUpdate:visible":y},{visible:m.value,class:S.value,style:r.value,clickOutside:!0,disabled:O.value||e.readonly,offset:yl,placement:"bottom",target:M.value,trigger:"manual"}),{default:P,content:R})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Sl=gl,Il=H,wl=q;export{Il as I,Sl as a,wl as b};
