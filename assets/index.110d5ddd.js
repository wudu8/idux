import{c as v,u as C,f as O,g as L,o as p,h as B,i as I,s as N,j as P}from"./index.418e0b9f.js";import{P as _,f as d,Q as k,k as g,O as j,Z as T,E as w,l as $,G as A,K as R}from"./vendor.379ae99b.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const E=Symbol("anchorToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const G={affix:v.bool.def(!0),bounds:v.number,hideLinkBall:v.bool,offsetTop:v.number,target:v.oneOfType([String,HTMLElement]),targetOffset:v.number,onChange:v.emit(),onClick:v.emit()},H={href:v.string.isRequired,title:v.string};var M=_({name:"IxAnchor",props:G,setup(e,{slots:o}){const a=C("common"),r=d(()=>`${a.prefixCls}-anchor`),u=C("anchor"),t=d(()=>{var n;return(n=e.hideLinkBall)!=null?n:u.hideLinkBall}),s=d(()=>{const{offsetTop:n}=e;return{maxHeight:n?`calc(100vh - ${n}px)`:"100vh"}}),{activeLink:c}=q(e,u),{anchorRef:h,inkBallClasses:l,inkBallTop:f}=F(c,r);return()=>{var n;const i=r.value,x=t.value?null:k("span",{class:l.value,style:{top:f.value}},null),m=k("div",{class:`${i}-wrapper`,style:s.value},[k("div",{class:i,ref:h},[k("div",{class:`${i}-ink`},[x]),(n=o.default)==null?void 0:n.call(o)])]);return e.affix?k(O,{target:e.target,offset:e.offsetTop},{default:()=>[m]}):m}}});const q=(e,o)=>{const a=g([]),r=l=>{a.value.includes(l)||a.value.push(l)},u=l=>{const f=a.value.indexOf(l);f!==-1&&a.value.splice(f,1)},t=g(),s=l=>{t.value!==l&&(t.value=l,I(e.onChange,l))},{scrollTo:c}=Q(e,o,a,s);return j(E,{registerLink:r,unregisterLink:u,activeLink:t,handleLinkClick:(l,f)=>{I(e.onClick,l,f),c(f.href)}}),{activeLink:t}},F=(e,o)=>{const a=g(),r=d(()=>{const t=o.value;return{[`${t}-ink-ball`]:!0,[`${t}-ink-ball-visible`]:!!e.value}}),u=g();return T(()=>{w(()=>{var t;const s=(t=a.value)==null?void 0:t.querySelector(`a[data-href="${e.value}"]`);if(!s)return;const{offsetTop:c,clientHeight:h}=s;u.value=`${c+h/2-4.5}px`})}),{anchorRef:a,inkBallClasses:r,inkBallTop:u}},y=(e,o)=>{const a=document.getElementById(e.split("#")[1]);if(a){const{top:r}=P(a,o);return r}return null},K=(e,o,a,r)=>e.reduce((t,s)=>{const c=y(s,o);return c!==null&&c<a+r&&t.top<c?{link:s,top:c}:t},{link:"",top:Number.MIN_SAFE_INTEGER}).link,Q=(e,o,a,r)=>{const u=d(()=>{var n;return(n=e.bounds)!=null?n:o.bounds}),t=g(),s="scroll";let c=!1;const h=d(()=>{var n,i;return(i=(n=e.targetOffset)!=null?n:e.offsetTop)!=null?i:0}),l=()=>{if(c)return;const n=K(a.value,t.value,h.value,u.value);r(n)},f=n=>{r(n);const i=y(n,t.value);i!==null&&(c=!0,N({amountOfChange:i-h.value,target:t.value,callback:()=>{c=!1}}))};return $(()=>e.target,()=>{B(t.value,s,l),t.value=L(e.target),p(t.value,s,l),l()}),T(()=>{t.value=L(e.target),p(t.value,s,l),l()}),A(()=>{B(t.value,s,l)}),{scrollTo:f}};var U=_({name:"IxAnchorLink",props:H,setup(e,{slots:o}){const a=C("common"),r=d(()=>`${a.prefixCls}-anchor-link`),{registerLink:u,unregisterLink:t,activeLink:s,handleLinkClick:c}=R(E);$(()=>e.href,(n,i)=>{t(i),u(n)}),T(()=>u(e.href)),A(()=>t(e.href));const h=d(()=>s.value===e.href),l=d(()=>{const n=r.value;return{[`${n}-title`]:!0,[`${n}-title-active`]:h.value}}),f=n=>c(n,e);return()=>{var n,i,x;const{href:m,title:b}=e,S=r.value;return k("div",{class:S},[k("a",{class:l.value,href:m,"data-href":m,title:b,onClick:f},[(i=(n=o.title)==null?void 0:n.call(o))!=null?i:b]),(x=o.default)==null?void 0:x.call(o)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const z=M,D=U;export{z as I,D as a};
